@page "/"

@inject ILivroServices livroServices
@inject IProdutoServices produtoServices
@inject IImagemServices imagemServices

@rendermode InteractiveServer

@attribute [AllowAnonymous]

<PageTitle>Home</PageTitle>

<div class="container">
    <div class="row">
        <div class="col-12 col-md-5">
            <div class="justify-content-center justify-content-center-md-start mb-3 mb-md-0">
                <div class="input-group input-group-sm">
                    <input type="text" class="form-control" placeholder="Digite seu Produto Procurado" />
                    <button class="btn btn-info">Digite seu Produto Desejado</button>
                </div>
            </div>
        </div>
        <hr class="mt-3" />
        <div class="row">
            @foreach (var item in listaProdutos!)
            {
                <ItemCard Item="item" Imagens="ConsultarListaImagens(item.Id)" />
            }
        </div>
    </div>
</div>

@code {
    List<ProdutoViewModel>? listaProdutos = new List<ProdutoViewModel>();

    protected override async Task OnInitializedAsync()
    {
        listaProdutos = await produtoServices.GetAll();

        StateHasChanged();
    }

    private async Task<List<ImagemViewModel>> ConsultarListaImagens(int idProduto)
    {
        return await imagemServices.ConsultarPorIdProduto(idProduto);
    }
}